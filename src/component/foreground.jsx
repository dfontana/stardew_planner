import React, { Component } from 'react'
import styled from 'styled-components'
import { drawStatic, setScale, scrn } from './util'

const Canvas = styled.canvas`
  grid-area: 1/1/1/1;
  z-index: 2;
`

class Foreground extends Component {
  constructor(props) {
    super(props)
    this.setRef = e => {
      this.canvas = e
      this.ctx = e.getContext("2d")
    }
  }
  
  componentDidMount() {
    setScale(this.canvas, this.ctx)
    drawStatic(this.ctx, '/img/farm_house.png', 59, 8, 9, 9)
    drawStatic(this.ctx, '/img/farm_greenhouse.png', 25, 8, 7, 8)
    this.drawBoundaries()
  }

  drawBoundaries = () => {
    console.time('Path Method Construction')
    let p = new Path2D()
    // Grandpa's Grave
    p.moveTo(...scrn(12, 13))
    p.lineTo(...scrn(13, 13))
    p.lineTo(...scrn(13, 7))
    p.lineTo(...scrn(12, 7))
    p.lineTo(...scrn(12, 9))
    p.lineTo(...scrn(7, 9))
    p.lineTo(...scrn(7, 6))
    p.lineTo(...scrn(6, 6))
    p.lineTo(...scrn(6, 12))
    p.lineTo(...scrn(7, 12))
    p.lineTo(...scrn(7, 13))

    // Connector from Grave to Greenhouse
    p.moveTo(...scrn(18, 18))
    p.lineTo(...scrn(18, 16))
    p.lineTo(...scrn(16, 16))
    p.lineTo(...scrn(16, 17))
    p.lineTo(...scrn(11, 17))
    p.lineTo(...scrn(11, 19))
    p.lineTo(...scrn(12, 19))
    p.lineTo(...scrn(12, 20))
    p.lineTo(...scrn(17, 20))
    p.lineTo(...scrn(17, 19))
    p.lineTo(...scrn(18, 19))

    // Top Bridge into Farm
    p.moveTo(...scrn(41, 1))
    p.lineTo(...scrn(41, 3))
    p.lineTo(...scrn(43, 3))
    p.lineTo(...scrn(43, 1))

    // Farm House Isalnd
    p.moveTo(...scrn(22, 18))
    p.lineTo(...scrn(22, 15))
    p.lineTo(...scrn(21, 15))
    p.lineTo(...scrn(21, 12))
    p.lineTo(...scrn(22, 12))
    p.lineTo(...scrn(22, 9))
    p.lineTo(...scrn(23, 9))
    p.lineTo(...scrn(23, 8))
    p.lineTo(...scrn(28, 8))
    p.lineTo(...scrn(28, 7))
    p.lineTo(...scrn(29, 7))
    p.lineTo(...scrn(29, 6))
    p.lineTo(...scrn(30, 6))
    p.lineTo(...scrn(30, 5))
    p.lineTo(...scrn(32, 5))
    p.lineTo(...scrn(32, 9))
    p.lineTo(...scrn(39, 9))
    p.lineTo(...scrn(39, 7))
    p.lineTo(...scrn(47, 7))
    p.lineTo(...scrn(47, 8))
    p.lineTo(...scrn(52, 8))
    p.lineTo(...scrn(52, 6))
    p.lineTo(...scrn(57, 6))
    p.lineTo(...scrn(57, 7))
    p.lineTo(...scrn(58, 7))
    p.lineTo(...scrn(58, 8))
    p.lineTo(...scrn(59, 8))
    p.lineTo(...scrn(59, 9))
    // --- (Behind upper fence, not sure)
    p.lineTo(...scrn(68, 9))
    p.lineTo(...scrn(68, 7))
    p.lineTo(...scrn(69, 7))
    p.lineTo(...scrn(69, 6))
    p.lineTo(...scrn(76, 6))
    p.lineTo(...scrn(76, 8))
    p.lineTo(...scrn(70, 8))
    p.lineTo(...scrn(70, 11))
    // ---
    p.lineTo(...scrn(79, 11))
    p.lineTo(...scrn(79, 16))
    p.lineTo(...scrn(81, 16))
    p.lineTo(...scrn(81, 20))
    p.lineTo(...scrn(78, 20))
    p.lineTo(...scrn(78, 29))
    p.lineTo(...scrn(68, 29))
    p.lineTo(...scrn(68, 32))
    p.lineTo(...scrn(64, 32))
    p.lineTo(...scrn(64, 29))
    p.lineTo(...scrn(60, 29))
    p.lineTo(...scrn(60, 28))
    p.lineTo(...scrn(59, 28))
    p.lineTo(...scrn(59, 27))
    p.lineTo(...scrn(58, 27))
    p.lineTo(...scrn(58, 25))
    p.lineTo(...scrn(57, 25))
    p.lineTo(...scrn(57, 24))
    p.lineTo(...scrn(55, 24))
    p.lineTo(...scrn(55, 23))
    p.lineTo(...scrn(52, 23))
    p.lineTo(...scrn(52, 24))
    p.lineTo(...scrn(50, 24))
    p.lineTo(...scrn(50, 25))
    p.lineTo(...scrn(49, 25))
    p.lineTo(...scrn(49, 29))
    p.lineTo(...scrn(48, 29))
    p.lineTo(...scrn(48, 30))
    p.lineTo(...scrn(41, 30))
    p.lineTo(...scrn(41, 29))
    p.lineTo(...scrn(35, 29))
    p.lineTo(...scrn(35, 26))
    p.lineTo(...scrn(33, 26))
    p.lineTo(...scrn(33, 25))
    p.lineTo(...scrn(30, 25))
    p.lineTo(...scrn(30, 24))
    p.lineTo(...scrn(23, 24))
    p.lineTo(...scrn(23, 23))
    p.lineTo(...scrn(22, 23))
    // --- (Omit GreenHouse)
    p.moveTo(...scrn(26, 17))
    p.lineTo(...scrn(33, 17))
    p.lineTo(...scrn(33, 11))
    p.lineTo(...scrn(26, 11))
    // --- (Omit House)
    p.moveTo(...scrn(60, 12))
    p.lineTo(...scrn(60, 18))
    p.lineTo(...scrn(70, 18))
    p.lineTo(...scrn(70, 17))
    p.lineTo(...scrn(69, 17))
    p.lineTo(...scrn(69, 12))
    // --- (Omit Fencing)
    p.moveTo(...scrn(56, 7))
    p.lineTo(...scrn(56, 8))
    p.lineTo(...scrn(55, 8))
    p.lineTo(...scrn(55, 9))
    p.lineTo(...scrn(56, 9))
    p.lineTo(...scrn(56, 11))
    p.lineTo(...scrn(57, 11))
    p.lineTo(...scrn(57, 12))
    p.lineTo(...scrn(59, 12))
    p.lineTo(...scrn(59, 11))
    p.lineTo(...scrn(57, 11))
    p.lineTo(...scrn(57, 7))
    p.lineTo(...scrn(56, 7))

    // Left island below farmhouse
    p.moveTo(...scrn(20, 29))
    p.lineTo(...scrn(30, 29))
    p.lineTo(...scrn(30, 30))
    p.lineTo(...scrn(31, 30))
    p.lineTo(...scrn(31, 31))
    p.lineTo(...scrn(32, 31))
    p.lineTo(...scrn(32, 36))
    p.lineTo(...scrn(31, 36))
    p.lineTo(...scrn(31, 37))
    p.lineTo(...scrn(30, 37))
    p.lineTo(...scrn(30, 38))
    p.lineTo(...scrn(20, 38))
    p.lineTo(...scrn(20, 37))
    p.lineTo(...scrn(19, 37))
    p.lineTo(...scrn(19, 36))
    p.lineTo(...scrn(18, 36))
    p.lineTo(...scrn(18, 31))
    p.lineTo(...scrn(19, 31))
    p.lineTo(...scrn(19, 30))
    p.lineTo(...scrn(20, 30))
    p.lineTo(...scrn(20, 29))
    
    // Right island below farmhouse
    p.moveTo(...scrn(64, 37))
    p.lineTo(...scrn(68, 37))
    p.lineTo(...scrn(68, 38))
    p.lineTo(...scrn(70, 38))
    p.lineTo(...scrn(70, 41))
    p.lineTo(...scrn(73, 41))
    p.lineTo(...scrn(73, 42))
    p.lineTo(...scrn(74, 42))
    p.lineTo(...scrn(74, 43))
    p.lineTo(...scrn(75, 43))
    p.lineTo(...scrn(75, 48))
    p.lineTo(...scrn(74, 48))
    p.lineTo(...scrn(74, 49))
    p.lineTo(...scrn(73, 49))
    p.lineTo(...scrn(73, 50))
    p.lineTo(...scrn(68, 50))
    p.lineTo(...scrn(68, 49))
    p.lineTo(...scrn(66, 49))
    p.lineTo(...scrn(66, 47))
    p.lineTo(...scrn(64, 47))
    p.lineTo(...scrn(64, 46))
    p.lineTo(...scrn(63, 46))
    p.lineTo(...scrn(63, 45))
    p.lineTo(...scrn(62, 45))
    p.lineTo(...scrn(62, 39))
    p.lineTo(...scrn(63, 39))
    p.lineTo(...scrn(63, 38))
    p.lineTo(...scrn(64, 38))
    p.lineTo(...scrn(64, 37))

    // Left Island
    p.moveTo(...scrn(20, 43))
    p.lineTo(...scrn(20, 48))
    p.lineTo(...scrn(19, 48))
    p.lineTo(...scrn(19, 49))
    p.lineTo(...scrn(15, 49))
    p.lineTo(...scrn(15, 50))
    p.lineTo(...scrn(6, 50))
    p.lineTo(...scrn(6, 51))
    p.lineTo(...scrn(3, 51))
    p.lineTo(...scrn(3, 50))
    p.lineTo(...scrn(4, 50))
    p.lineTo(...scrn(4, 49))
    p.lineTo(...scrn(6, 49))
    p.lineTo(...scrn(6, 48))
    p.lineTo(...scrn(8, 48))
    p.lineTo(...scrn(8, 41))
    p.lineTo(...scrn(7, 41))
    p.lineTo(...scrn(7, 40))
    p.lineTo(...scrn(5, 40))
    p.lineTo(...scrn(5, 39))
    p.lineTo(...scrn(4, 39))
    p.lineTo(...scrn(4, 37))
    p.lineTo(...scrn(6, 37))
    p.lineTo(...scrn(6, 36))
    p.lineTo(...scrn(8, 36))
    p.lineTo(...scrn(8, 35))
    p.lineTo(...scrn(10, 35))
    p.lineTo(...scrn(10, 34))
    p.lineTo(...scrn(13, 34))
    p.lineTo(...scrn(13, 35))
    p.lineTo(...scrn(14, 35))
    p.lineTo(...scrn(14, 39))
    p.lineTo(...scrn(15, 39))
    p.lineTo(...scrn(15, 40))
    p.lineTo(...scrn(16, 40))
    p.lineTo(...scrn(16, 41))
    p.lineTo(...scrn(18, 41))
    p.lineTo(...scrn(18, 42))
    p.lineTo(...scrn(19, 42))
    p.lineTo(...scrn(19, 43))
    p.lineTo(...scrn(20, 43))

    // Lower Large Island
    p.moveTo(...scrn(27, 42))
    p.lineTo(...scrn(33, 42))
    p.lineTo(...scrn(33, 41))
    p.lineTo(...scrn(34, 41))
    p.lineTo(...scrn(34, 40))
    p.lineTo(...scrn(35, 40))
    p.lineTo(...scrn(35, 39))
    p.lineTo(...scrn(36, 39))
    p.lineTo(...scrn(36, 38))
    p.lineTo(...scrn(38, 38))
    p.lineTo(...scrn(38, 37))
    p.lineTo(...scrn(54, 37))
    p.lineTo(...scrn(54, 38))
    p.lineTo(...scrn(56, 38))
    p.lineTo(...scrn(56, 39))
    p.lineTo(...scrn(57, 39))
    p.lineTo(...scrn(57, 41))
    p.lineTo(...scrn(58, 41))
    p.lineTo(...scrn(58, 47))
    p.lineTo(...scrn(59, 47))
    p.lineTo(...scrn(59, 50))
    p.lineTo(...scrn(53, 50))
    p.lineTo(...scrn(53, 52))
    p.lineTo(...scrn(51, 52))
    p.lineTo(...scrn(51, 53))
    p.lineTo(...scrn(47, 53))
    p.lineTo(...scrn(47, 52))
    p.lineTo(...scrn(45, 52))
    p.lineTo(...scrn(45, 51))
    p.lineTo(...scrn(44, 51))
    p.lineTo(...scrn(44, 50))
    p.lineTo(...scrn(37, 50))
    p.lineTo(...scrn(37, 51))
    p.lineTo(...scrn(36, 51))
    p.lineTo(...scrn(36, 52))
    p.lineTo(...scrn(31, 52))
    p.lineTo(...scrn(31, 50))
    p.lineTo(...scrn(30, 50))
    p.lineTo(...scrn(30, 48))
    p.lineTo(...scrn(29, 48))
    p.lineTo(...scrn(29, 47))
    p.lineTo(...scrn(27, 47))
    p.lineTo(...scrn(27, 46))
    p.lineTo(...scrn(26, 46))
    p.lineTo(...scrn(26, 43))
    p.lineTo(...scrn(27, 43))
    p.lineTo(...scrn(27, 42))

    // Bottom Left Island
    p.moveTo(...scrn(17, 54))
    p.lineTo(...scrn(24, 54))
    p.lineTo(...scrn(24, 55))
    p.lineTo(...scrn(25, 55))
    p.lineTo(...scrn(25, 57))
    p.lineTo(...scrn(28, 57))
    p.lineTo(...scrn(28, 58))
    p.lineTo(...scrn(29, 58))
    p.lineTo(...scrn(29, 64))
    p.lineTo(...scrn(28, 64))
    p.lineTo(...scrn(28, 63))
    p.lineTo(...scrn(8, 63))
    p.lineTo(...scrn(8, 62))
    p.lineTo(...scrn(7, 62))
    p.lineTo(...scrn(7, 61))
    p.lineTo(...scrn(6, 61))
    p.lineTo(...scrn(6, 60))
    p.lineTo(...scrn(4, 60))
    p.lineTo(...scrn(4, 56))
    p.lineTo(...scrn(12, 56))
    p.lineTo(...scrn(12, 55))
    p.lineTo(...scrn(17, 55))
    p.lineTo(...scrn(17, 54))

    // Bottom Right Island
    p.moveTo(...scrn(47, 57))
    p.lineTo(...scrn(62, 57))
    p.lineTo(...scrn(62, 58))
    p.lineTo(...scrn(63, 58))
    p.lineTo(...scrn(63, 59))
    p.lineTo(...scrn(64, 59))
    p.lineTo(...scrn(64, 61))
    p.lineTo(...scrn(65, 61))
    p.lineTo(...scrn(65, 63))
    p.lineTo(...scrn(45, 63))
    p.lineTo(...scrn(45, 64))
    p.lineTo(...scrn(41, 64))
    p.lineTo(...scrn(41, 61))
    p.lineTo(...scrn(42, 61))
    p.lineTo(...scrn(42, 60))
    p.lineTo(...scrn(43, 60))
    p.lineTo(...scrn(43, 59))
    p.lineTo(...scrn(46, 59))
    p.lineTo(...scrn(46, 58))
    p.lineTo(...scrn(47, 58))
    p.lineTo(...scrn(47, 57))
    console.timeEnd('Path Method Construction')

    this.bounds = p
    this.ctx.fillStyle = 'rgba(0,0,255,0.5)'
    this.ctx.fill(p)
    this.ctx.fillStyle = 'rgba(255,0,0,0.5)'
    this.ctx.fill(p)
    
  }

  handleClick = (e) => {
    e = e.nativeEvent
    
    // isPointInPath uses an untransformed path space, so to determine if click
    // occurs within bounds, we have to scale the mouse coordiantes.
    let scale = window.devicePixelRatio || 1
    let isValid = this.ctx.isPointInPath(this.bounds, e.offsetX * scale, e.offsetY * scale)
    console.log(`(${e.offsetX}, ${e.offsetY}): ${isValid}`)
  }

  render(){
    return (
      <Canvas innerRef={this.setRef} onMouseMove={this.props.onMouseMove} 
              onMouseLeave={this.props.onMouseLeave} onClick={this.handleClick} />
    )
  }
}

export default Foreground